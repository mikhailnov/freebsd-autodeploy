<html>
<head>
	<title>Как быстро настроить прокси 3proxy на своем сервере на FreeBSD? Готовый скрипт настройки и пошаговая инструкция по аренде вирутального сервера заграницей.</title>
	<meta charset="UTF-8">
</head>
<body>
	<h1>Как быстро настроить прокси 3proxy на своем сервере на FreeBSD? Готовый скрипт настройки и пошаговая инструкция по аренде вирутального сервера заграницей.</h1>
	
	<p>В этой статье рассмотрим, как быстро поднять свой собственный прокси-сервер.</p>
	<p>Proxy позволяет перенаправлять трафик с вашего компьютера на сервер. Например, вы хотите открыть некий через прокси. Тогда ваш компьютер обращается к прокси, прокси подключается к сайту, получает его содержимое и перенаправляет его на ваш компьютер. Таким образом, сайт видит внешний IP прокси-сервера, а не вашего компьютера, а если сайт заблокирован, например, Роскомнадзором или президентом Украины, то можно сделать прокси-сервер в другой стране, в которой нужные вам ресурсы не заблокированы, и тем самым получить к ним доступ в обход блокировок. Главное, чтобы из вашей страны не был заблокирован сам прокси-сервер. Также вы сможете настроить, например, Telegram на работу через свой собственный прокси, который не будет периодически умирать, как большинство бесплатных прокси.</p>
	
	<h2>Выбор хостинга, где арендовать вирутальный сервер</h2>
	<p><b>Определитесь с задачами прокси-сервера: куда вы собираетесь через него ходить?</b><br>
	Если это ресурсы, заблокированные в вашей стране, то нужен виртуальный сервер в другой стране. Например, вы живете на Украине и хотите иметь доступ к Яндексу, Вконтакте, Dr.Web, Kaspersky и другим заблокированным ресурсам. Тогда вам подойдет виртуальный сервер в России. По сравнению с, например, европейским сервером российский позволит определять ваш регион как «Россия» и выдавать соответствующий геозависимый контент сайта, а также скорсоть открытия сайтов будет чуть выше, т.к. магистральные каналы до российских серверов шире, чем до европейских.</p>
	<p>Жители России могут арендовать сервер в Украине, но тогда вы попадете под различные украинские блокировки, поэтому лучше всего использовать европейский сервер, тогда вы сможете без проблем иметь доступ ко всем сайтам и месседжерам, в т.ч. получите беспроблемно работающий Telegram.</p>
	<p>Выбираем хостинг, на котором арендуем виртуальный сервер.</p>
	<p><b>Виртуальный сервер</b> — это виртуальная машина, отдельная операционная система, работающая на хосте виртуализации, то есть на большом сервере с множеством вируталньых. Это позволяет нам платить только за нужное нам количество ресурсов. К ресурсам относят процессор, оеративную память и место на диске. <b>Хостинг</b> — это компания, предоставляющая услуги аренды сервера.</p>
	<p>Вы можете встретить 2 основных типа виртуализации: <b>OpenVZ</b> и <b>KVM</b>. Про их отличия в интернете есть множество статей, нам нужен <b>KVM</b>, иначе не сможем запустить операционную систему <b>FreeBSD</b>. Нам будет достаточно любого минимального тарифа.</p>
	<p>В качестве недорого хостинга в России рекомендую <a href="https://www.ihor.ru/vds?from=225629" target="_blank">«Айхор»</a>. Он сочетает в себе низкие цены, тарифы с маленьким, но достаточным для прокси-серверов количеством ресурсов без переплаты за неиспользуемые ресурсы, и достаточно удобное управление. Ниже скриншот заказа виртуального сервера на их сайте после регистрации.<br>
	<img src="img/img1.png"><br>
	<img src="img/img2.png"><br></p>
	<p>Совсем дешевые VPS за границей можно найти на сайте <a href="https://lowendbox.com/" target="_blank">lowendbox.com</a>. Обратите внимание, что обычно виртуализация OpenVZ или ее родственник Virtuozoo стоят дешевле, однако нам нужен KVM с возможностью установить FreeBSD 11 или просто произвольную операционную систему из своего образа, если FreeBSD не предлагается на выбор при автоматической настройке сервера (в таком случае берите образ FreeBSD *disk1.iso <a href="https://download.freebsd.org/ftp/releases/amd64/amd64/ISO-IMAGES/11.1/" target="_blank">отсюда</a>).</p>
	<p>Мы же ниже подробно разберем весь процесс на примере недорого и надежного зарубежного хостинга <a href="https://www.vultr.com/?ref=7418199" target="_blank">Vultr</a>.</p>
	
	<h2>Регистрация на сайте хостинга Vultr</h2>
	<ol>
		<li>Идем на сайт <a href="https://www.vultr.com/?ref=7418199" target="_blank">vultr.com</a><br></li>
		<li>Нажимаем "Create account" ("Создать аккаунт"):</li>
			<img src="img/img3.png"><br>
		<li>Заполняем открывшуюся форму:<br>
			<img src="img/img4.png"><br>
		<ul>
			<li>E-mail (электронная почта)</li>
			<li>
				Пароль, который должен удовлетворять следующим условиям:
				<ul>
					<li>Не менее 10 символов</li>
					<li>Содержать хотя бы одну заглавную букву</li>
					<li>Содержать хотя бы одну строчную букву</li>
					<li>Содержать хотя бы одну цифру</li>
				</ul>
			</li>
			<li>Пройти капчу</li>
		</ul>
		</li>
		<li>Нажать "Create Account" ("Создать учетную запись")</li>
		<li>Перейти по ссылке в пришедшем на указанную почту письме ("Verify Your E-mail")<br>
			<img src="img/img5.png"><br>
		</li>
		<li>После перехода по ссылке из письма ввести пароль и нажать "Login" ("Войти")<br>
			<img src="img/img6.png"><br>
		</li>
	</ol>
	<h2>Добавление платежной банковской карты в Vultr</h2>
	<p>После регистрации в Vultr баланс составляет 10 долларов, однако, чтобы ими воспользоваться, нужно привязать банковскую карту или пополнить счет. После того, как вы вошли в личный кабинет Vultr, перейдите в раздел "Billing" ("Платежи") в левом меню и добавьте банковскую карту или пополните счет через Paypal. Заполните поля, как показано на картинке ниже. Обратите внимание, что указание адреса — это формальность, если вы его укажите неправильно, платеж все равно пройдет. Оплата за сервер <b>почасовая</b>.<br>
	<img src="img/img7.png"><br>
	Галка "I just want to link my credit card - $0.00 deposit" означает, что будет выполнена просто привязка карты без списания выбранной суммы (по умолчанию $10), а как закончатся подарочные $10, деньги начнут списываться с привязанной карты. Если ее не отметить, то выбранная сумма будет списана сразу. Поставьте галку "I agree to the terms of service" ("Согласен с условиями использования").</p>
	<p>После заполнения формы нажмите большую синюю кнопку "Link credit card" ("Привязать банковскую карту").</p>
	
	<h2>Создание виртуального сервера с FreeBSD в Vultr</h2>
	<p>После добавления банковской карты откроется страница создания нового виртуального сервера (в дальнейшем будем его называть прсото сервером). В любое другое время туда можно попасть из раздела "Servers":<br>
	<img src="img/img8.png"><br></p>
	<p>Теперь нужно выставить параметры создаваемого сервера.</p>
	<ol>
		<li>Выбираем дата-центр (страну), где будет расположен сервер. Когда начинал писать эту статью, из европейских локаций была доступна Франция, однако на момент снятия скриншота она временно недоступна. Выбирайте Недерланды (Амстердам), Германию (Франкфурт) или Париж (Францию). Пинг до европейских серверов будет немного ниже, чем до американских, однако вы вряд ли заметите разницу при использовании прокси-сервера. У большинства операторов трафик в Японию (Tokyo, Japan) и Сингапур (Singapore) в обе сторону идет по маршруту Россия-Европа-США-Япония/Сингапур или Россия-Европа-Суэцкий канал-Япония/Сингапур, но у Ростелекома есть прямые каналы на Японию через Дальний Восток России (в ряде случаев траифк все равно ходит через США), что уменьшает пинг и увеличивает скорость. Я выберу Японию, но большинству пользователей рекомендую Европу или США.<br>
		<img src="img/img9.png"><br></li>
		<li>Выбираем операционную систему FreeBSD 11 x64<br>
		<img src="img/img10.png"><br></li>
		<li>Выбираем тариф. подойдет минимальный тариф за 2 с половиной долларов в месяц, если он недоступен, как на момент написания статьи, выбираем тариф за 5$ в месяц.<br>
		<img src="img/img11.png"><br></li>
		<li>Ставим галку "Enable IPv6" для влючения IPv6 на виртуальном сервере (обратите внимание, что для работы прокси через IPv6 ваш интернет-провайдер все равно должен поддерживать IPv6). Если не поддерживает, то эта галка никак не помешает — будет работать через IPv4.<br>
		<img src="img/img12.png"><br></li>
		<li><i>Внимание! Если вы не очень поняли этот пункт, то пропустите его.</i><br>
		Если вы на своем компьютере используете операционную систему <b>Linux</b> (или FreeBSD), то для удобного и безопасного захода на сервер вместо пароля можно использовать авторизацию по SSH-ключу. Сначала на компьютере создайте SSH-ключ, не от root, а от пользователя выполнив команду в терминале:<br>
		<code>ssh-keygen</code><br>
		Затем выведите в терминал и скопируйте содержимое вашего публичного SSH-ключа:<br>
		<code>cat ~/.ssh/id_rsa.pub</code><br>
		Его и нужно добавить в Vultr как свой публичный SSH ключ, чтобы с компьютера заходить в управление сервером по SSH без пароля.<br>
		<img src="img/img13.png"><br>
		<img src="img/img14.png"><br>
		</li>
		<li>Все настройки сделаны, для создания сервера нажмите "Deploy now":<br>
		<img src="img/img15.png"><br></li>
		<li>В разделе "Servers" в списке своих серверов вы увидите, что на вновь созданный сервер устаналивается операционная система ("Installing..."), а значит через несколкьо минут сервер будет готов к работе:
		<img src="img/img16.png"><br>
		Тогда желтая надпись "Installing" будет изменена на зеленую "Running".</li>
	</ol>
	<p>После создания сервера вам на почту придет письмо с его IP адресом и, если не была настроена авторизация по SSH-ключам, паролем для пользователя root.</p>
	
	<h2>Проверка сервера на доступность. Удаление сервера</h2>
	<p>На <a href="https://blocklist.rkn.gov.ru/" target="_blank">сайте Роскомнадзора</a> можно проверить, не заблокирован ли IP-адрес вашего сервера в России. Если заблокирован, то создавайте новые сервера (оплата за время использования, а не сразу за месяц), пока вам не попадется сервер с незаблокированным IP-адресом, а затем удалите все лишние ранее созаднные сервера, как показано на скриншоте:<br>
	<img src="img/img17.png"><br></p>
	
	<h2>Настройка сервера</h2>
	<p>Вот мы и создали наш виртуальный сервер, поздравляю! Теперь пришло время подключиться к его командной строке и запустить скрипт для автоматической настройки прокси-сервера 3proxy. Скрипт <a href="https://github.com/mikhailnov/freebsd-autodeploy/tree/master" target="_blank">freebsd-autodeploy</a> был написан специально для этой статьи и операционной системы FreeBSD.</p>
	<ol>
		<li>В панели управления Vultr нажимаем на сервер и смотрим root-пароль:<br>
		<img src="img/img18.png"><br></li>
		<li>
			<p>Подключаемся к серверу по SSH — протоколу удаленного управления через командную строку. Если вы боитесь командной строки и думаете, что она неудобна, то в UNIX-подобных ОС она <b>гораздо</b> удобнее, чем в Windows, и прочитайте статью <a href="https://nixtux.ru/432" target="_blank">«Почему консоль, а не графический интерфейс?»</a></p>
			<p>Если вы используете <b>Linux/UNIX/MacOS</b>, то подключиться к серверу по SSH очень просто. Для этого откройте терминал и выполните команду:<br>
			<code>ssh root@ip-адрес-сервера</code>,<br>
			в которую подставьте IP своего сервера. В целом команда имеет следующий вид: <code>ssh имя_пользователя@IP_или_домен_сервера -p порт</code>. Если не указан порт, то используется стандартный — 22.<br></p>
			<p>При первом подключении нужно ввести <code>yes</code> и нажать Enter. <b>При вводе пароля он НЕ отображается никак!</b> Скриншот:<br>
			<img src="img/img19.png"><br></p>
			<p>Дальше у вас есть полноценный графический терминал,в  котором можно мышью с помощью контекстного меню или клавишами Ctrl+Shift+C, Ctrl+Shift+V копировать и вставлять текст, а по средней кнопке мыши работает параллельный буфер обмена, вставляющий ранее выделенный текст. что очень сильно экономит время, т.к. не нужно копировать и вставлять.</p>
			<p>Чтобы каждый раз не вводить пароль, вы можете скопировать свой локальный публичный SSH-ключ на сервер:<br>
			<code>ssh-copy-id root@ip-адрес-сервера</code></p>
			<p>Если вы используете <b>Windows</b>, то для подключения к серверу по SSH воспользуйтесь бесплатной программой <a href="http://putty.org.ru/download.html" target="_blank">Putty</a> (по удобству очень сильно уступает графическому терминалу в Linux):<br>
			<img src="img/img20.png"><br></p>
		</li>
		<li>На сервере последовательно выполняем команды ниже. Одна команда — одна строка. Копируем-всталяем команду в терминал и нажимаем Enter.<br>
		<code>env ASSUME_ALWAYS_YES=yes pkg install -y pkg git nano</code><br>
		<code>cd</code><br>
		<code>git clone -b v1.1-comss.ru https://github.com/mikhailnov/freebsd-autodeploy.git</code><br>
		<code>cd freebsd-autodeploy</code><br>
		<code>./freebsd-autodeploy.sh 3proxy-setup</code><br>
		</li>
	</ol>
</body>
</html>
